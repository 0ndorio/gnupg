2002-01-25  Werner Koch  <wk@gnupg.org>

	* gpgsm.c (main): Disable core dumps.

	* sign.c (add_certificate_list): New.
	(gpgsm_sign): Add the certificates to the CMS object.
	* certpath.c (gpgsm_walk_cert_chain): New.
	* gpgsm.h (server_control_s): Add included_certs.
	* gpgsm.c: Add option --include-certs.
	(gpgsm_init_default_ctrl): New.
	(main): Call it.
	* server.c (gpgsm_server): Ditto.
	(option_handler): Support --include-certs.

2002-01-23  Werner Koch  <wk@gnupg.org>

	* certpath.c (gpgsm_validate_path): Print the DN of a missing issuer.
	* certdump.c (gpgsm_dump_string): New.
	(print_dn): Replaced by above.

2002-01-22  Werner Koch  <wk@gnupg.org>

	* certpath.c (unknown_criticals): New.
	(allowed_ca): New.
	(gpgsm_validate_path): Check validity, CA attribute, path length
	and unknown critical extensions.

2002-01-21  Werner Koch  <wk@gnupg.org>

	* gpgsm.c: Add option --enable-crl-checks.

	* call-agent.c (start_agent): Implemented socket based access.
	* call-dirmngr.c (start_dirmngr): Ditto.

2002-01-20  Werner Koch  <wk@gnupg.org>

	* server.c (option_handler): New.
	(gpgsm_server): Register it with assuan.

2002-01-19  Werner Koch  <wk@gnupg.org>

	* server.c (gpgsm_server): Use assuan_deinit_server and setup
	assuan logging if enabled.
	* call-agent.c (inq_ciphertext_cb): Don't show the session key in
	an Assuan log file.

	* gpgsm.c (my_strusage): Take bugreport address from configure.ac

2002-01-15  Werner Koch  <wk@gnupg.org>

	* import.c (gpgsm_import): Just do a basic cert check before
	storing it.
	* certpath.c (gpgsm_basic_cert_check): New.

	* keydb.c (keydb_store_cert): New.
	* import.c (store_cert): Removed and change all caller to use
	the new function.
	* verify.c (store_cert): Ditto.

	* certlist.c (gpgsm_add_to_certlist): Validate the path

	* certpath.c (gpgsm_validate_path): Check the trust list.
	* call-agent.c (gpgsm_agent_istrusted): New.

2002-01-14  Werner Koch  <wk@gnupg.org>

	* call-dirmngr.c (inq_certificate): Changed for new interface semantic.
	* certlist.c (gpgsm_find_cert): New.

2002-01-13  Werner Koch  <wk@gnupg.org>

	* fingerprint.c (gpgsm_get_certid): Print the serial and not the
	hash after the dot.

2002-01-11  Werner Koch  <wk@gnupg.org>

	* call-dirmngr.c: New.
	* certpath.c (gpgsm_validate_path): Check the CRL here.
	* fingerprint.c (gpgsm_get_certid): New.
	* gpgsm.c: New options --dirmngr-program and --disable-crl-checks.

2002-01-10  Werner Koch  <wk@gnupg.org>

	* base64.c (gpgsm_create_writer): Allow to set the object name

2002-01-08  Werner Koch  <wk@gnupg.org>

	* keydb.c (spacep): Removed because it is now in util.c

	* server.c (cmd_genkey): New.
	* certreqgen.c: New.  The parameter handling code has been taken
	from gnupg/g10/keygen.c version 1.0.6.
	* call-agent.c (gpgsm_agent_genkey): New.

2002-01-02  Werner Koch  <wk@gnupg.org>

	* server.c (rc_to_assuan_status): Removed and changed all callers
	to use map_to_assuan_status.

2001-12-20  Werner Koch  <wk@gnupg.org>

	* verify.c (gpgsm_verify): Implemented non-detached signature
	verification.  Add OUT_FP arg, initialize a writer and changed all
	callers.
	* server.c (cmd_verify): Pass an out_fp if one has been set.

	* base64.c (base64_reader_cb): Try to detect an S/MIME body part.

	* certdump.c (print_sexp): Renamed to gpgsm_dump_serial, made
	global.
	(print_time): Renamed to gpgsm_dump_time, made global.
	(gpgsm_dump_serial): Take a real S-Expression as argument and
	print the first item.
	* keylist.c (list_cert_colon): Ditto.
	* keydb.c (keydb_search_issuer_sn): Ditto.
	* decrypt.c (print_integer_sexp): Removed and made callers 
	use gpgsm_dump_serial.
	* verify.c (print_time): Removed, made callers use gpgsm_dump_time.
	
2001-12-19  Marcus Brinkmann  <marcus@g10code.de>

	* call-agent.c (start_agent): Add new argument to assuan_pipe_connect.

2001-12-18  Werner Koch  <wk@gnupg.org>

	* verify.c (print_integer_sexp): Renamed from print_integer and
	print the serial number according to the S-Exp rules.
	* decrypt.c (print_integer_sexp): Ditto.

2001-12-17  Werner Koch  <wk@gnupg.org>

	* keylist.c (list_cert_colon): Changed for new return value of
	get_serial.
	* keydb.c (keydb_search_issuer_sn): Ditto.
	* certcheck.c (gpgsm_check_cert_sig): Likewise for other S-Exp
	returingin functions.
	* fingerprint.c (gpgsm_get_keygrip): Ditto.
	* encrypt.c (encrypt_dek): Ditto
	* certcheck.c (gpgsm_check_cms_signature): Ditto
	* decrypt.c (prepare_decryption): Ditto.
	* call-agent.c (gpgsm_agent_pkdecrypt): Removed arg ciphertextlen,
	use KsbaSexp type and calculate the length.

	* certdump.c (print_sexp): Remaned from print_integer, changed caller.

	* Makefile.am: Use the LIBGCRYPT and LIBKSBA variables.

	* fingerprint.c (gpgsm_get_keygrip): Use the new
	gcry_pk_get_keygrip to calculate the grip - note the algorithm and
	therefore the grip values changed.

2001-12-15  Werner Koch  <wk@gnupg.org>

	* certcheck.c (gpgsm_check_cms_signature): Removed the faked-key
	kludge.
	(gpgsm_create_cms_signature): Removed the commented fake key
	code.  This makes the function pretty simple.

	* gpgsm.c (main): Renamed the default key database to "keyring.kbx".

	* decrypt.c (gpgsm_decrypt): Write STATUS_DECRYPTION_*.
	* sign.c (gpgsm_sign): Write a STATUS_SIG_CREATED.

2001-12-14  Werner Koch  <wk@gnupg.org>

	* keylist.c (list_cert_colon): Kludge to show an email address
	encoded in the subject's DN.

	* verify.c (gpgsm_verify): Add hash debug helpers
	* sign.c (gpgsm_sign): Ditto.

	* base64.c (base64_reader_cb): Reset the linelen when we need to
	skip the line and adjusted test; I somehow forgot about DeMorgan.

	* server.c (cmd_encrypt,cmd_decrypt,cmd_sign,cmd_verify) 
	(cmd_import): Close the FDs on success.
	(close_message_fd): New.
	(input_notify): Setting autodetect_encoding to 0 after initializing
	it to 0 is pretty pointless.  Easy to fix.

	* gpgsm.c (main): New option --debug-wait n, so that it is
	possible to attach gdb when used in server mode.

	* sign.c (get_default_signer): Use keydb_classify_name here.

2001-12-14  Marcus Brinkmann  <marcus@g10code.de>

	* call-agent.c (LINELENGTH): Removed.
	(gpgsm_agent_pksign): Use ASSUAN_LINELENGTH, not LINELENGTH.
	(gpgsm_agent_pkdecrypt): Likewise.

2001-12-13  Werner Koch  <wk@gnupg.org>

	* keylist.c (list_cert_colon): Print alternative names of subject
	and a few other values.

2001-12-12  Werner Koch  <wk@gnupg.org>

	* gpgsm.c (main): New options --assume-{armor,base64,binary}. 
	* base64.c (base64_reader_cb): Fixed non-autodetection mode.

2001-12-04  Werner Koch  <wk@gnupg.org>

	* call-agent.c (read_from_agent): Check for inquire responses.
	(request_reply): Handle them using a new callback arg, changed all
	callers.
	(gpgsm_agent_pkdecrypt): New.

2001-11-27  Werner Koch  <wk@gnupg.org>

	* base64.c: New.  Changed all other functions to use this instead
	of direct creation of ksba_reader/writer.
	* gpgsm.c (main): Set ctrl.auto_encoding unless --no-armor is used.

2001-11-26  Werner Koch  <wk@gnupg.org>

	* gpgsm.c: New option --agent-program
	* call-agent.c (start_agent): Allow to override the default path
	to the agent.

	* keydb.c (keydb_add_resource): Create keybox

	* keylist.c (gpgsm_list_keys): Fixed non-server keylisting.

	* server.c (rc_to_assuan_status): New.  Use it for all commands.

	
 Copyright 2001, 2002 Free Software Foundation, Inc.

 This file is free software; as a special exception the author gives
 unlimited permission to copy and/or distribute it, with or without
 modifications, as long as this notice is preserved.

 This file is distributed in the hope that it will be useful, but
 WITHOUT ANY WARRANTY, to the extent permitted by law; without even the
 implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.



    * For packet version 3 we calculate the keyids this way:
	RSA	:= low 64 bits of n
	ELGAMAL := build a v3 pubkey packet (with CTB 0x99) and calculate
		   a rmd160 hash value from it. This is used as the
		   fingerprint and the low 64 bits are the keyid.




Layout of the TrustDB
=====================
FIXME: use a directory record as top node instead of the pubkey record

The TrustDB is build from fixed length records, where the first bytes
describes the record type.  All numeric values are stored in network
byte order. The length of each record is 40 bytes. The first record of
the DB is always of type 1 and this is the only record of this type.

Record type 0:
--------------
    Unused record, can be reused for any purpose.

Record type 1:
--------------
    Version information for this TrustDB.  This is always the first
    record of the DB and the onyl one with type 1.
     1 byte value 1
     3 bytes 'g10'  magic value
     1 byte Version of the TrustDB
     3 byte reserved
     1 u32  locked by (pid) 0 = not locked.
     1 u32  timestamp of trustdb creation
     1 u32  timestamp of last modification
     1 u32  timestamp of last validation
	    (Used to keep track of the time, when this TrustDB was checked
	     against the pubring)
     1 u32  reserved
     1 byte marginals needed
     1 byte completes needed
     1 byte max. cert depth
	    If any of this 3 values are changed, all cache records
	    muts be invalidated.
     9 bytes reserved


Record type 2: (directory record)
--------------
    Informations about a public key certificate.
    These are static values which are never changed without user interaction.

     1 byte value 2
     1 byte   reserved
     8 bytes keyid (We keep it here to speed up searching by keyid)
     1 u32   Local-Id.	This is simply the record number of this record.
     1 u32   pubkey (record number of it)
     1 u32   cache record
     1 u32   sigrecord
     1 byte  No signatures flag  (used to avoid duplicate building).
     13 byte reserved


Record type 3:
--------------
    Informations about a public key certificate.
    These are static values which are never changed without user interaction.

     1 byte value 3
     1 byte   reserved
     1 u32   owner  This is used to bind all records for
	     a given certificate together. It is valid only in this TrustDB
	     and usefull if we have duplicate keyids
	     It points back to the directory node.
     1 byte pubkey algorithm
     1 byte reserved
     20 bytes fingerprint of the public key
     1 byte ownertrust:
     3 byte reserved


Record type 4:	(cache record)
--------------
    Used to bind the trustDB to the concrete instance of keyblock in
    a pubring. This is used to cache informations.

     1 byte   value 4
     1 byte   reserved
     1 u32    Local-Id.
     8 bytes  keyid of the primary key (needed?)
     1 byte   cache-is-valid the following stuff is only
	      valid if this is set.
     1 byte   reserved
     20 bytes rmd160 hash value over the complete keyblock
	      This is used to detect any changes of the keyblock with all
	      CTBs and lengths headers. Calculation is easy if the keyblock
	      is optained from a keyserved: simply create the hash from all
	      received data bytes.

     1 byte   number of untrusted signatures.
     1 byte   number of marginal trusted signatures.
     1 byte   number of fully trusted signatures.
	      (255 is stored for all values greater than 254)
     1 byte   Trustlevel
		0 = undefined (not calculated)
		1 = unknown
		2 = not trusted
		3 = marginally trusted
		4 = fully trusted
		5 = ultimately trusted (have secret key too).

Record type 5  (sigrec)
-------------
    Used to keep track of valid key signatures. Self-signatures are not
    stored.

     1 byte   value 5
     1 byte   reserved
     1 u32    For Local-Id (points back to the directory record)
     1 u32    chain: next sigrec of this owner or 0 to indicate the
	      last sigrec.
     6 times
	1 u32  Local_id of signators pubkey record
	1 byte reserved


